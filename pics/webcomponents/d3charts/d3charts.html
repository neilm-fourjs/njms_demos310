<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta charset="utf-8">
		<title>D3Charts examples</title>
		<link rel="stylesheet" href="style.css" type="text/css">

		<script src="https://d3js.org/d3.v5.min.js"></script>

		<script type="text/javascript">
			var chart;
			var myProps
// This function is called by the Genero Client Container
// so the web component can initialize itself and initialize
// the gICAPI handlers
			onICHostReady = function(version) {

				if ( version != 1.0 ) {
					alert('Invalid API version');
					return;
				}

				gICAPI.onFocus = function( polarity ) {
				}

				gICAPI.onProperty = function(props) {
					myProps = eval("(" + props + ")");
				}

				gICAPI.onData = function( data ) {
					chartData = eval("(" + data + ")");
					//document.getElementById("data2").innerHTML=data;
					doChart();
				}
			}

			function handleClick(event)
			{
					//alert(event.item.category + ": " + event.item.values.value + " p:" + event.item.description );
					gICAPI.SetData( event.item.category );
					gICAPI.Action( event.item.description );
			}

			function doChart() {
				var data = chartData;
				var height = 500;
				var barWidth = 40;
				var width = ( barWidth * data.length );

				margin = ({top: 20, right: 0, bottom: 30, left: 40})

				x = d3.scaleBand()
					.domain(data.map(d => d.name))
					.range([margin.left, width - margin.right])
					.padding(0.1)
				y = d3.scaleLinear()
					.domain([0, d3.max(data, d => d.value)]).nice()
					.range([height - margin.bottom, margin.top])
				xAxis = g => g
					.attr("transform", `translate(0,${height - margin.bottom})`)
					.call(d3.axisBottom(x)
							.tickSizeOuter(0))
				yAxis = g => g
					.attr("transform", `translate(${margin.left},0)`)
					.call(d3.axisLeft(y))
					.call(g => g.select(".domain").remove())

				var svg = d3.select(".chart")
											.attr("height", height)
											.attr("width", barWidth * data.length);

				svg.append("g")
						.attr("fill", "steelblue")
					.selectAll("rect").data(data).enter().append("rect")
						.attr("x", d => x(d.name))
						.attr("y", d => y(d.value))
						.attr("height", d => y(0) - y(d.value))
						.attr("width", x.bandwidth());
				
				svg.append("g")
						.call(xAxis);
				
				svg.append("g")
						.call(yAxis);
			}

		</script>
	</head>

	<body class="grad">
		<h1>D3Chart Demo</h1>
		<svg class="chart" style="width: 800px;	height: 600px;"></svg>
		<!--div id="data2"></div-->
	</body>

</html>
